clear all;
close all;
clc;

%% get data

R_ROBOT = 15;

% cx cy cr
obs = [
% robots
[0., 0., 0., 1, 1, 1];   %primary
[0., 0., R_ROBOT+12., 1, 1, 1];   %secondary
[0., 0., R_ROBOT+20., 1, 1, 1];   %primary adv
[0., 0., R_ROBOT+15., 1, 1, 1];   %secondary adv

% arbres
[0.  , 70. , R_ROBOT+10, 0, 1, 1];
[70. , 0.  , R_ROBOT+10, 0, 1, 1];
[230., 0.  , R_ROBOT+10, 0, 1, 1];
[300., 70. , R_ROBOT+10, 0, 1, 1];

% bac fruit
[75. , 185., R_ROBOT+15,0, 1, 1];
[42. , 185., R_ROBOT+5, 0, 1, 1];
[108. ,185., R_ROBOT+5, 0, 1, 1];
[42. , 172., R_ROBOT+5, 0, 1, 1];
[108., 172., R_ROBOT+5, 0, 1, 1];

[225., 185., R_ROBOT+15,0, 1, 1];
[192., 185., R_ROBOT+5, 0, 1, 1];
[258., 185., R_ROBOT+5, 0, 1, 1];
[192., 172., R_ROBOT+5, 0, 1, 1];
[258., 172., R_ROBOT+5, 0, 1, 1];

% foyers
[0.  , 0.  , R_ROBOT+27, 0, 1, 1];
[300., 0.  , R_ROBOT+27, 0, 1, 1];
[150., 95. , R_ROBOT+18, 0, 1, 1];

% torches mobile
[90. , 90. , R_ROBOT+9, 1, 1, 1];
[210., 90. , R_ROBOT+9, 1, 1, 1];

% torches fixe
[1.1  , 125.8, R_ROBOT+1, 0, 1, 1];
[1.1  , 114.2, R_ROBOT+1, 0, 1, 1];
[135.8, 1.1  , R_ROBOT+1, 0, 1, 1];
[124.2, 1.1  , R_ROBOT+1, 0, 1, 1];
[175.8, 1.1  , R_ROBOT+1, 0, 1, 1];
[164.2, 1.1  , R_ROBOT+1, 0, 1, 1];
[298.9, 125.8, R_ROBOT+1, 0, 1, 1];
[298.9, 114.2, R_ROBOT+1, 0, 1, 1];

% feux
[40. , 90. , R_ROBOT+7, 1, 1, 1];
[90. , 40. , R_ROBOT+7, 1, 1, 1];
[90. , 140., R_ROBOT+7, 1, 1, 1];
[210., 40. , R_ROBOT+7, 1, 1, 1];
[210., 140., R_ROBOT+7, 1, 1, 1];
[260., 90. , R_ROBOT+7, 1, 1, 1];

[1.  , 120., R_ROBOT+2, 1, 1, 1];
[130., 1.  , R_ROBOT+2, 1, 1, 1];
[170., 1.  , R_ROBOT+2, 1, 1, 1];
[299., 120., R_ROBOT+2, 1, 1, 1];

[90. , 90. , R_ROBOT+7, 1, 1, 1];
[90. , 90. , R_ROBOT+7, 1, 1, 1];
[90. , 90. , R_ROBOT+7, 1, 1, 1];
[210., 90. , R_ROBOT+7, 1, 1, 1];
[210., 90. , R_ROBOT+7, 1, 1, 1];
[210., 90. , R_ROBOT+7, 1, 1, 1];

%Cercles du robot anti-demi-tour
[0., 0. , 0, 0, 0, 1];
[0., 0. , 0, 0, 0, 1];
[0., 0. , 0, 0, 0, 1];

%Cercles d'approches
[0., 0. , 0, 0, 0, 1];
[0., 0. , 0, 0, 0, 1];
[0., 0. , 0, 0, 0, 1];

% arrivée
[0. , 0., 0, 0, 1, 1];

];


% p1x p1y p2x p2y s_l cx cy cr a_l
traj = [
%new path from 0a to 53a (48.06cm, 1 steps):
[284.50 184.20 267.50 139.25 48.06 267.50 139.25 0.00 0.00];
%new path from 0a to 53a (131.68cm, 2 steps):
[267.72 139.71 218.28 119.62 53.36 210.00 140.00 22.00 14.67];
[203.90 118.86 142.75 136.50 63.65 142.75 136.50 0.00 0.00];
%new path from 0a to 53a (117.45cm, 3 steps):
[143.12 136.40 125.63 117.25 25.93 150.00 95.00 -33.00 16.34];
[117.98 103.00 113.28 84.18 19.39 90.00 90.00 24.00 28.76];
[93.06 66.20 66.25 62.75 27.03 66.25 62.75 0.00 0.00];
%new path from 0a to 53a (117.45cm, 3 steps):
[143.12 136.40 125.63 117.25 25.93 150.00 95.00 -33.00 16.34];
[117.98 103.00 113.28 84.18 19.39 90.00 90.00 24.00 28.76];
[93.06 66.20 66.25 62.75 27.03 66.25 62.75 0.00 0.00];
%new path from 0a to 53a (111.10cm, 3 steps):
[66.58 62.79 66.01 89.48 26.70 90.00 90.00 24.00 28.55];
[80.59 112.08 98.62 119.76 19.60 90.00 140.00 -22.00 10.07];
[106.68 125.65 123.75 145.50 26.18 123.75 145.50 0.00 0.00];
];


A = dlmread('~/Bureau/loc_f.csv', ',', 1, 0);
% dt,x;y;theta

%A = A(3:end,:);

dt = A(:,1); % (µs)
x = A(:,2)/10; % (cm)
y = A(:,3)/10; % (cm)
theta = A(:,4)*pi/180; % (rad)

%% show data

% figure;
% plot(dt);

figure;axis equal;axis([0 300 0 200]);hold on;
thet = 0:pi/100:2*pi;
for i = 1:size(obs,1)
    cx = obs(i, 1);
    cy = obs(i, 2);
    cr = obs(i, 3);
    plot(cx+cr*cos(thet), cy+cr*sin(thet), 'r');
end
for i = 1:size(traj,1)
    p1 = traj(i, 1:2)';
    p2 = traj(i, 3:4)';
    plot([p1(1), p2(1)], [p1(2), p2(2)], 'k');
end
plot(x,y,'-*')
for i = 1:size(theta,1)
    p1 = [x(i); y(i)];
    p2 = [x(i) + 5*cos(theta(i)); y(i) + 5*sin(theta(i))];
    plot([p1(1), p2(1)], [p1(2), p2(2)], 'g');
end
